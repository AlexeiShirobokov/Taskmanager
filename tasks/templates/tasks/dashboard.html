{% extends 'base.html' %}
{% block title %}–î–∞—à–±–æ—Ä–¥ - –ú–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–¥–∞—á{% endblock %}

{% block content %}
<div class="container">
    <!-- Header -->
    <div class="box has-background-primary-light">
        <div class="columns is-vcentered">
            <div class="column">
                <h1 class="title is-2 has-text-primary">üìä –î–∞—à–±–æ—Ä–¥ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h1>
                <p class="subtitle">–ê–Ω–∞–ª–∏–∑ –≤–∞—à–µ–π –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
            </div>
            <div class="column has-text-right">
                <div class="tags are-large">
                    <span class="tag is-primary">–û–±–Ω–æ–≤–ª–µ–Ω–æ: {% now "H:i" %}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- KPI Cards -->
    <div class="columns is-multiline">
        <div class="column is-one-quarter">
            <div class="card has-background-white-bis">
                <div class="card-content has-text-centered">
                    <div class="icon-text is-justify-content-center">
                        <span class="icon has-text-info">
                            <i class="fas fa-tasks fa-2x"></i>
                        </span>
                    </div>
                    <p class="title has-text-info">{{ total_tasks }}</p>
                    <p class="subtitle">–í—Å–µ–≥–æ –∑–∞–¥–∞—á</p>
                </div>
            </div>
        </div>

        <div class="column is-one-quarter">
            <div class="card has-background-success-light">
                <div class="card-content has-text-centered">
                    <div class="icon-text is-justify-content-center">
                        <span class="icon has-text-success">
                            <i class="fas fa-check-circle fa-2x"></i>
                        </span>
                    </div>
                    <p class="title has-text-success">{{ completed_tasks }}</p>
                    <p class="subtitle">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</p>
                </div>
            </div>
        </div>

        <div class="column is-one-quarter">
            <div class="card has-background-danger-light">
                <div class="card-content has-text-centered">
                    <div class="icon-text is-justify-content-center">
                        <span class="icon has-text-danger">
                            <i class="fas fa-exclamation-triangle fa-2x"></i>
                        </span>
                    </div>
                    <p class="title has-text-danger">{{ overdue_tasks }}</p>
                    <p class="subtitle">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</p>
                </div>
            </div>
        </div>

        <div class="column is-one-quarter">
            <div class="card has-background-info-light">
                <div class="card-content has-text-centered">
                    <div class="icon-text is-justify-content-center">
                        <span class="icon has-text-info">
                            <i class="fas fa-chart-line fa-2x"></i>
                        </span>
                    </div>
                    <p class="title has-text-info">{{ completion_rate }}%</p>
                    <p class="subtitle">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Progress Section -->
    <div class="box">
        <h2 class="title is-4">üìà –ü—Ä–æ–≥—Ä–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</h2>
        <div class="progress-container">
            <progress class="progress is-success is-large" value="{{ completion_rate }}" max="100">
                {{ completion_rate }}%
            </progress>
            <div class="level mt-4">
                <div class="level-item has-text-centered">
                    <div>
                        <p class="heading">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</p>
                        <p class="title is-4 has-text-success">{{ completed_tasks }}</p>
                    </div>
                </div>
                <div class="level-item has-text-centered">
                    <div>
                        <p class="heading">–í —Ä–∞–±–æ—Ç–µ</p>
                        <p class="title is-4">{{ total_tasks|add:completed_tasks|add:overdue_tasks }}</p>
                    </div>
                </div>
                <div class="level-item has-text-centered">
                    <div>
                        <p class="heading">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</p>
                        <p class="title is-4 has-text-danger">{{ overdue_tasks }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Grid -->
    <div class="columns is-multiline">
        <div class="column is-half">
            <div class="card">
                <div class="card-content">
                    <h3 class="title is-5">üìã –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á</h3>
                    {{ completion_chart|safe }}
                </div>
            </div>
        </div>

        <div class="column is-half">
            <div class="card">
                <div class="card-content">
                    <h3 class="title is-5">üìÖ –î–∏–Ω–∞–º–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è</h3>
                    {{ timeline_chart|safe }}
                </div>
            </div>
        </div>

        <div class="column is-half">
            <div class="card">
                <div class="card-content">
                    <h3 class="title is-5">üë• –ü–æ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º</h3>
                    {{ responsible_chart|safe }}
                </div>
            </div>
        </div>

        <div class="column is-half">
            <div class="card">
                <div class="card-content">
                    <h3 class="title is-5">‚è∞ –°—Ä–æ–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</h3>
                    {{ deadline_chart|safe }}
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="columns">
        <div class="column">
            <div class="card">
                <div class="card-content">
                    <h3 class="title is-5">‚úÖ –ù–µ–¥–∞–≤–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ</h3>
                    {% if recently_completed %}
                        <div class="content">
                            {% for task in recently_completed %}
                            <article class="media">
                                <figure class="media-left">
                                    <span class="icon has-text-success">
                                        <i class="fas fa-check-circle"></i>
                                    </span>
                                </figure>
                                <div class="media-content">
                                    <div class="content">
                                        <p>
                                            <strong>{{ task.title }}</strong>
                                            <br>
                                            <small>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π: {{ task.responsible.get_full_name|default:task.responsible.username }}</small>
                                            <br>
                                            <small>–°—Ä–æ–∫: {{ task.deadline|date:"d.m.Y H:i" }}</small>
                                        </p>
                                    </div>
                                </div>
                            </article>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="has-text-centered py-4">
                            <span class="icon is-large has-text-grey-light">
                                <i class="fas fa-inbox fa-3x"></i>
                            </span>
                            <p class="has-text-grey">–ù–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="column">
            <div class="card">
                <div class="card-content">
                    <h3 class="title is-5">üöÄ –ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –∑–∞–¥–∞—á–∏</h3>
                    {% if upcoming_tasks %}
                        <div class="content">
                            {% for task in upcoming_tasks %}
                            <article class="media">
                                <figure class="media-left">
                                    <span class="icon has-text-warning">
                                        <i class="fas fa-calendar-alt"></i>
                                    </span>
                                </figure>
                                <div class="media-content">
                                    <div class="content">
                                        <p>
                                            <strong>{{ task.title }}</strong>
                                            <br>
                                            <small>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π: {{ task.responsible.get_full_name|default:task.responsible.username }}</small>
                                            <br>
                                            <small class="has-text-danger">–î–æ: {{ task.deadline|date:"d.m.Y H:i" }}</small>
                                        </p>
                                    </div>
                                </div>
                            </article>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="has-text-centered py-4">
                            <span class="icon is-large has-text-grey-light">
                                <i class="fas fa-calendar-check fa-3x"></i>
                            </span>
                            <p class="has-text-grey">–ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –∑–∞–¥–∞—á</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Font Awesome –¥–ª—è –∏–∫–æ–Ω–æ–∫ -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>

<style>
    .card {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        border-radius: 12px;
        overflow: hidden;
    }

    .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }

    .progress-container {
        position: relative;
    }

    progress::-webkit-progress-value {
        border-radius: 20px;
        background: linear-gradient(45deg, #00d1b2, #3273dc);
    }

    .icon-text .icon {
        margin-bottom: 0.5rem;
    }

    .media {
        border-left: 3px solid transparent;
        padding-left: 1rem;
        margin-bottom: 1rem;
    }

    .media:hover {
        border-left-color: #3273dc;
        background: #f5f5f5;
    }
</style>
{% endblock %}